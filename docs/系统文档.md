# 废弃物AI识别指导投放系统 - 系统文档

## 📋 目录

- [系统概述](#系统概述)
- [功能特点](#功能特点)
- [技术架构](#技术架构)
- [安装部署](#安装部署)
- [使用说明](#使用说明)
- [配置说明](#配置说明)
- [故障排除](#故障排除)
- [开发指南](#开发指南)

## 🎯 系统概述

废弃物AI识别指导投放系统是一个基于AI技术的智能垃圾分类指导系统，通过实时摄像头检测、运动识别和AI分析，为用户提供准确的垃圾分类指导和语音提示。

### 核心功能
- **🎥 实时摄像头检测** - 自动检测和捕获垃圾图像
- **🏃 智能运动检测** - 精准识别用户投放动作
- **🤖 AI智能识别** - 准确分类垃圾类型
- **🎨 动态状态显示** - 流畅的识别流程动画
- **🔊 语音指导播放** - 清晰的分类投放指导
- **📱 现代化界面** - 直观友好的用户体验

## ✨ 功能特点

### 1. **智能识别流程**
```
用户投放 → 运动检测 → 图像捕获 → AI识别 → 结果显示 → 语音指导
```

### 2. **动态状态显示**
- **等待检测**：🔍 脉冲动画 + "请将垃圾放入检测区域"
- **检测到物体**：👁️ 脉冲动画 + "检测到物体，请保持稳定"
- **正在识别**：🤖 旋转动画 + 进度条 + "正在识别中，请稍候..."
- **识别成功**：✅ 显示详细结果 + 分类指导 + 语音播放

### 3. **垃圾分类支持**
- **🔵 可回收物**：塑料瓶、纸张、金属等
- **🔴 有害垃圾**：电池、药品、化学品等
- **🟤 湿垃圾**：食物残渣、果皮、茶叶渣等
- **⚫ 干垃圾**：其他垃圾、污损纸张等

## 🏗️ 技术架构

### 系统架构图
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   用户界面层     │    │   业务逻辑层     │    │   工具服务层     │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ • 主界面        │    │ • 检测工作器     │    │ • 配置管理       │
│ • 动态状态显示   │    │ • 运动检测       │    │ • 语音指导       │
│ • 指导界面      │    │ • IO控制        │    │ • API客户端      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                ↓
                    ┌─────────────────┐
                    │     数据层       │
                    ├─────────────────┤
                    │ • 配置文件       │
                    │ • 图片数据       │
                    │ • 日志文件       │
                    └─────────────────┘
```

### 技术栈
- **Python 3.12+** - 主要开发语言
- **PySide6** - 现代化Qt界面框架
- **OpenCV** - 计算机视觉和图像处理
- **RKNN** - AI推理引擎（可选）
- **PyTTSx3** - 语音合成和播放

### 核心组件

#### 1. **用户界面层**
```python
ui/
├── main_window.py              # 主窗口界面
├── dynamic_status_widget.py    # 动态状态显示组件
├── guidance_widget.py          # 垃圾分类指导界面
└── motion_detection_test_window.py  # 运动检测测试界面
```

#### 2. **业务逻辑层**
```python
worker/
├── waste_detection_worker.py   # 废弃物检测工作器
├── motion_detection_worker.py  # 运动检测工作器
└── io_control_worker.py        # IO控制工作器
```

#### 3. **工具服务层**
```python
utils/
├── config_manager.py          # 配置管理器
├── voice_guide.py             # 语音指导
├── api_client.py              # API客户端
├── motion_detector.py         # 运动检测器
├── smart_motion_detector.py   # 智能运动检测器
├── error_recovery.py          # 错误恢复
├── memory_manager.py          # 内存管理
└── performance_monitor.py     # 性能监控
```

## 🚀 安装部署

### 环境要求
- **操作系统**：Windows 10/11, Linux, macOS
- **Python版本**：3.12 或更高版本
- **硬件要求**：
  - USB摄像头或CSI摄像头
  - 4GB+ 内存
  - 2GB+ 存储空间

### 安装步骤

#### 1. 克隆项目
```bash
git clone <repository-url>
cd 废弃物AI识别指导投放项目
```

#### 2. 安装依赖
```bash
pip install -r requirements.txt
```

#### 3. 配置系统
```bash
# 复制配置模板
cp config/system_config.json.template config/system_config.json
cp config/waste_classification.json.template config/waste_classification.json

# 编辑配置文件
nano config/system_config.json
```

#### 4. 启动系统
```bash
# 推荐启动方式
python main.py

# 使用启动器
python launcher.py
```

## 📖 使用说明

### 基本操作流程

#### 1. **系统启动**
- 启动应用程序
- 系统自动初始化各个组件
- 显示主界面和功能状态

#### 2. **垃圾投放检测**
- 将垃圾放入摄像头检测区域
- 系统自动检测运动并捕获图像
- AI分析识别垃圾类型
- 显示分类结果和投放指导

#### 3. **语音指导**
- 系统自动播放语音指导
- 可通过界面控制语音开关
- 支持多种垃圾分类的语音提示

### 界面说明

#### 主界面布局
```
┌─────────────────┬─────────────────┐
│                 │                 │
│   摄像头显示     │   动态状态显示   │
│                 │                 │
│   • 实时画面     │   • 识别状态     │
│   • 检测框显示   │   • 进度动画     │
│   • FPS显示     │   • 结果展示     │
│                 │   • 投放指导     │
└─────────────────┴─────────────────┘
│            状态栏显示              │
└─────────────────────────────────────┘
```

#### 菜单功能
- **文件菜单**：退出程序
- **设置菜单**：语音设置、摄像头设置、参数配置、IO控制
- **检测菜单**：开始/停止检测、显示检测结果
- **帮助菜单**：使用说明、关于信息

#### 参数配置界面
通过"设置"→"参数配置"打开图形化配置界面：
- **📷 摄像头**：设备ID、分辨率、帧率等
- **🤖 AI检测**：模型路径、置信度阈值等
- **🏃 运动检测**：敏感度、ROI区域等
- **🌐 API**：服务器地址、密钥等
- **🎨 界面**：主题、语言、窗口设置等
- **🔊 音频**：语音开关、音量、速度等
- **⚡ 性能**：帧率限制、线程数等
- **🔧 高级**：日志、IO控制、动画等

### 快捷键
- **F11**：切换全屏模式
- **ESC**：退出全屏模式
- **Ctrl+Q**：退出程序

## ⚙️ 配置说明

### 系统配置文件 (`config/system_config.json`)

#### 摄像头配置
```json
{
  "camera": {
    "device_id": 0,
    "width": 640,
    "height": 480,
    "fps": 30
  }
}
```

#### 运动检测配置
```json
{
  "motion_detection": {
    "motion_threshold": 25,
    "min_contour_area": 500,
    "detection_cooldown": 3.0,
    "capture_delay": 1.0
  }
}
```

#### API配置
```json
{
  "api": {
    "base_url": "https://api.example.com",
    "api_key": "your-api-key",
    "timeout": 30,
    "max_retries": 3
  }
}
```

#### 语音配置
```json
{
  "voice": {
    "enabled": true,
    "language": "zh",
    "rate": 150,
    "volume": 0.8
  }
}
```

### 垃圾分类配置文件 (`config/waste_classification.json`)

```json
{
  "categories": {
    "可回收物": {
      "icon": "♻️",
      "color": "#007bff",
      "description": "可以回收利用的废弃物",
      "guidance": "请清洗后投放到蓝色垃圾桶",
      "examples": ["塑料瓶", "纸张", "金属罐"]
    }
  }
}
```

## 🔧 故障排除

### 常见问题

#### 1. **摄像头无法打开**
**症状**：程序启动后摄像头显示黑屏或错误信息

**解决方案**：
```bash
# 检查摄像头设备
ls /dev/video*  # Linux
# 或在设备管理器中查看摄像头状态 (Windows)

# 修改配置文件中的设备ID
{
  "camera": {
    "device_id": 1  # 尝试不同的设备ID
  }
}
```

#### 2. **AI模型加载失败**
**症状**：识别功能不可用，日志显示模型加载错误

**解决方案**：
- 确认模型文件存在于 `models/` 目录
- 检查RKNN库安装：`pip install rknnlite`
- 验证模型文件格式和版本

#### 3. **语音功能不工作**
**症状**：识别成功但无语音播放

**解决方案**：
```bash
# 安装语音库
pip install pyttsx3 pygame

# 检查音频设备
# Windows: 控制面板 → 声音
# Linux: alsamixer 或 pulseaudio
```

#### 4. **运动检测过于敏感**
**症状**：轻微移动就触发检测

**解决方案**：
```json
{
  "motion_detection": {
    "motion_threshold": 50,      // 增加阈值
    "min_contour_area": 1000,    // 增加最小面积
    "detection_cooldown": 5.0    // 增加冷却时间
  }
}
```

### 调试方法

#### 查看日志
```bash
# 实时查看日志
tail -f logs/waste_detection.log

# 查看错误日志
grep ERROR logs/waste_detection.log
```

#### 启用调试模式
```bash
# 设置环境变量
export DEBUG=1
python main.py
```

## 👨‍💻 开发指南

### 项目结构
```
废弃物AI识别指导投放项目/
├── config/                 # 配置文件
├── ui/                     # 界面模块
├── worker/                 # 后台工作器
├── utils/                  # 工具模块
├── models/                 # AI模型文件
├── data/                   # 数据文件
├── logs/                   # 日志文件
├── res/                    # 资源文件
├── docs/                   # 文档
├── examples/               # 示例代码
├── main.py                 # 主启动脚本
├── launcher.py             # 启动器
└── requirements.txt        # 依赖列表
```

### 添加新功能

#### 1. 添加新的垃圾分类
```json
// 编辑 config/waste_classification.json
{
  "新分类": {
    "icon": "🆕",
    "color": "#28a745",
    "description": "新分类描述",
    "guidance": "投放指导信息",
    "examples": ["示例1", "示例2"]
  }
}
```

#### 2. 扩展API支持
```python
# 在 utils/api_client.py 中添加新的API接口
class APIClient:
    def new_detection_api(self, image_data):
        # 实现新的API调用逻辑
        pass
```

#### 3. 自定义动画效果
```python
# 在 ui/dynamic_status_widget.py 中添加新动画
class DynamicStatusWidget:
    def new_animation_state(self):
        # 实现新的动画状态
        pass
```

### 代码规范

#### 命名规范
- **类名**：PascalCase (`WasteDetectionWorker`)
- **方法名**：snake_case (`detect_waste`)
- **常量**：UPPER_SNAKE_CASE (`MAX_DETECTION_RESULTS`)
- **私有方法**：_开头 (`_preprocess_image`)

#### 文档规范
```python
def detect_waste(self, image: np.ndarray) -> List[Dict]:
    """
    检测废弃物
    
    Args:
        image: 输入图像
        
    Returns:
        检测结果列表
        
    Raises:
        ValueError: 图像格式错误
    """
    pass
```

### 测试指南

#### 单元测试
```python
import unittest
from utils.config_manager import ConfigManager

class TestConfigManager(unittest.TestCase):
    def test_load_config(self):
        config = ConfigManager()
        self.assertIsNotNone(config.get_camera_config())
```

#### 集成测试
```python
# 测试完整的检测流程
def test_detection_workflow():
    # 1. 初始化系统
    # 2. 模拟运动检测
    # 3. 验证API调用
    # 4. 检查结果显示
    pass
```

## 📚 相关文档

- [启动说明](启动说明.md) - 详细的启动和配置指南
- [运动检测功能说明](运动检测功能说明.md) - 运动检测技术细节
- [主要功能说明](主要功能说明.md) - 核心功能介绍
- [IO控制和动画功能说明](IO控制和动画功能说明.md) - 高级功能说明
- [项目总结](项目总结.md) - 项目开发总结和技术成果

## 📞 技术支持

如有问题或建议，请通过以下方式联系：

- **问题反馈**：创建Issue描述问题
- **功能建议**：提交Feature Request
- **技术讨论**：参与项目讨论

---

**版本信息**：v1.0.0  
**最后更新**：2025-07-25  
**维护状态**：积极维护
